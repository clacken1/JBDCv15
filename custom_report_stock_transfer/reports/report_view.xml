<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<data>
        <template id="report_custom_str">
		    <t t-call="web.html_container">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="text-left container">
                            <h4>Transfers</h4>
                            <h6>Date: <t t-esc="start_dt"/> - <t t-esc="end_dt"/></h6><br/>
                        </div>
                        <div class="container" style="font-size: 10px;">
                            <table width="100%">
                                <tr style="margin:5px;padding:4px;">
                                    <th style="border:1px solid black" width="13%" class="text-center">Date</th>
                                    <th style="border:1px solid black" width="10%" class="text-center">Reference</th>
                                    <th style="border:1px solid black"  width="19%" class="text-center">Source Location</th>
                                    <th style="border:1px solid black"  width="19%" class="text-center">Destination Location</th>
                                    <th style="border:1px solid black"  width="15%" class="text-center">Products</th>
                                    <th style="border:1px solid black"  width="9%" class="text-center">Cost</th>
                                    <th style="border:1px solid black"  width="6%" class="text-center">Quantity</th>
                                    <th style="border:1px solid black"  width="9%" class="text-center">Total</th>
                                </tr>
                                <t t-set="total_amount_total" t-value="0"/>
                                <t t-set="previos_record" t-value=""/>
                                <t t-set="group_total_standard_price" t-value="0"/>
                                <t t-set="group_total_qty_done" t-value="0"/>
                                <t t-set="group_total_amount_total" t-value="0"/>
                                <t t-foreach="docs" t-as="l">
                                    <t t-set="amount_total" t-value="l.qty_done * l.product_id.standard_price"/>
                                    <t t-if="previos_record and previos_record != l.picking_id.name">
                                        <tr>
                                            <td style="border:1px solid black;padding-right:10px;" class="text-right" colspan="5"> <b>Total : <span t-esc="previos_record"/> </b></td>
                                            <td style="border:1px solid black" class="text-right"><t t-esc="group_total_standard_price" t-options='{"widget": "monetary", "display_currency": l.company_id.currency_id}'/></td>
                                            <td style="border:1px solid black" class="text-right"><t t-esc="group_total_qty_done"/></td>
                                            <td style="border:1px solid black" class="text-right"><t t-esc="group_total_amount_total" t-options='{"widget": "monetary", "display_currency": l.company_id.currency_id}'/></td>
                                            <t t-set="group_total_standard_price" t-value="l.product_id.standard_price"/>
                                            <t t-set="group_total_qty_done" t-value="l.qty_done"/>
                                            <t t-set="group_total_amount_total" t-value="amount_total"/>
                                        </tr>
                                    </t>
                                    <t t-else="">
                                        <t t-set="group_total_standard_price" t-value="group_total_standard_price + l.product_id.standard_price"/>
                                        <t t-set="group_total_qty_done" t-value="group_total_qty_done + l.qty_done"/>
                                        <t t-set="group_total_amount_total" t-value="group_total_amount_total + amount_total"/>
                                    </t>
                                    <tr>
                                        <t t-set="total_amount_total" t-value="total_amount_total + (l.qty_done * l.product_id.standard_price)"/>
                                        
                                        <td style="border:1px solid black" ><span t-field="l.picking_id.date_done"/></td>
                                        <td style="border:1px solid black" ><span t-field="l.picking_id.name"/></td>
                                        <td style="border:1px solid black" ><span t-field="l.picking_id.location_id.display_name"/></td>
                                        <td style="border:1px solid black" ><span t-field="l.picking_id.location_dest_id.display_name"/></td>
                                        <td style="border:1px solid black" ><span t-field="l.product_id.name"/></td>
                                        <td style="border:1px solid black"  class="text-right"><span t-field="l.product_id.standard_price" t-options='{"widget": "monetary", "display_currency": l.company_id.currency_id}'/></td>
                                        <td style="border:1px solid black"  class="text-right"><span t-field="l.qty_done"/></td>
                                        <td  style="border:1px solid black" class="text-right"><span t-esc="amount_total" t-options='{"widget": "monetary", "display_currency": l.company_id.currency_id}'/></td>
                                    </tr>
                                    <t t-set="previos_record" t-value="l.picking_id.name"/>
                                </t>
                                <tr>
                                    <td style="border:1px solid black"   class="text-center" colspan="7"><b>Total</b></td>
                                    <td style="border:1px solid black"  class="text-right"> <b><span t-esc="total_amount_total"/></b></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </t>
		    </t>
		</template>

		<record id="action_st_report" model="ir.actions.report">
            <field name="name">Stock Transfer Report</field>
            <field name="model">custom.stock.transfer.report</field>
            <field name="report_type">qweb-pdf</field>
            <field name="report_name">custom_report_stock_transfer.report_custom_str</field>
            <field name="report_file">custom_report_stock_transfer.report_custom_str</field>
            <field name="print_report_name">'Stock Transfer Report'</field>
            <field name="binding_model_id" ref="custom_report_stock_transfer.model_custom_stock_transfer_report"/>
            <field name="binding_type">report</field>
        </record>

        <record id="view_custom_report_stock_transfer_wizard" model="ir.ui.view">
            <field name="name">custom.stock.transfer.report.form</field>
            <field name="model">custom.stock.transfer.report</field>
            <field name="arch" type="xml">
                <form string="Stock Transfer Report">
                    <group col="4">
                        <field name="start_dt"/>
                        <field name="end_dt"/>
                    </group>
                    <footer>
                        <button name="generate_report" string="Print" type="object" class="btn-primary"/>
                        <button string="Cancel" class="btn-default" special="cancel" />
                    </footer>
                </form>
            </field>
        </record>  

        <record id="action_report_custom_report_stock_transfer" model="ir.actions.act_window">
            <field name="name">Stock Transfer Report</field>
            <field name="res_model">custom.stock.transfer.report</field>
            <field name="view_mode">form</field>
            <field name="context">{'default_report_type': 'customer'}</field>
            <field name="target">new</field>
        </record>

        <menuitem id="menu_custom_report_stock_transfer" name="Stock Transfer Report" action="action_report_custom_report_stock_transfer" parent="stock.menu_warehouse_report" sequence="1"/>

	</data>
</odoo>